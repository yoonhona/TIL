---
title : 6th Oracle Developer Meetup 
date : 2018년 05월 19일
---

#### 세미나 정보
1. 주제 : 6th Oracle Developer Meetup 
2. 일시 : 2018년 05월 19일
3. 주최 : 오라클
4. 장소 : 오라클 본사
5. 비고 : 

---

카프카
* 카카오에서는 서비스별 카프카를 운영 중이었으나 제대로 알게된 후 전사적으로  카프카를 운영 함
* 링크드인 
    * 클라와의 통신
    * 배치 작업의 실시간화
    * 데이터 정합성
    * 사이트의 규모가 커질수록 메시지큐 시스템의 과부하
* 요구사항(현재 기능)
    * Higi Throughput
    * 실시간 로그 통합
    * 무중단(장비의 장애)
    * 이기종과의 호환
    * 간단한 스케일 아웃
    * 프로듀서와 컨슈머 역할 분리
* 카프카 클러스터
    * 브로커라는 서버로 구성
    * 브로커에는 토픽
        * 토픽에 파티션으로 구성
            * 파티션안에 메시지를 저장
    * 오프센 < 파티션 < 토픽 < 브로커 < 카프카 클러스터
* 사용 사례
    * 장점
        * 실시간
        * 확장 용이
    * 로그 통합 (각 서버별 grep 하고 있어요.)
        * 카프카에서 각 서비스의 로그를 라인단위로 읽어 엘라스틱서치에 저장하여 사용
* 프로듀서
    * ACKS
        * 0 기본 매우 빠르지만 파틴션의 리더가 받았는지는 알수 없음
        * 1 파티션의 리더가 받았는지 확인, 대부분 기본값 ** 추천
        * ALL 전송은 늘지만 손실없는 메시지 전송 가능
* 컨슈머
    * pool 방식으로 메시지를 가져 감
    * 오프셋 순서대로 메시지를 가져 감
    * 파티션이 늘어나면 컨슈머가 가져가는 메시지의 순서가 보장되지 안는다.(파티션의 순서대로 가져가지 않는다. 오프셋의 순서대로만.)
    * 하나의 파티션은 하나의 컨슈머만 ( 파티션수 = 컨슈머 수 가장 최적화)
    * 컨슈머 하나가 죽으면 컨슈머끼리 정보를 공유하고 있기에 해당 컨슈머의 작업을 다른 컨슈머가 대신 한다.
* 기본적으로 메시지르 7일간 보관
    * 이런 특징을 사용하여 기능별 컨슈머를 구성하여 사용 가능하다.
    * 예를 들면 하나는 하둡, 하나는 엘라스틱서치 등
* 운영 관련 팁
    * 모니터링 : jmx를 사용하여 실시간으로 값을 저장, 대쉬보드를 통해서 보거나 알람을 받음
        * 카프카에서 발생한 로그는 또 카프카를 통해 저장소(엘라스틱서치)에 적재 후 대쉬보드(키바나)를 통해서 봄
    * 카프카 매니저 : 야후에서 공개한 오픈소스
        * 웹 UI 툴
        * 클러스터, 토픽, 오프셋, 브로커, 파티션
        * LAG : 컨슈머가 가지가지 않은 메시지 개수
            * burrow : 카프카 컨슈머 랙 체킹 오픈소스, json형태로 결과값을 보여줌
    * 파티션 수 늘려주세요!!
        * 컨슈머의 능력에 따라 파티션을 줄이거나 늘리는 것에 고려
    * 디스크 공간이 부족해요.
        * retention.hours 168(7일) // 글로벌 옵션
        * 대개 2~3일 함
        * retention.ms = 86400000 // 토픽 개별 설정 설정 후 5분 정도 텀이 있을 수 있음
* 카프카의 노드관리를 주키퍼에서 하기 때문에 주키퍼의 관리가 중요하다. 랙분리를 선호 하심.
* 데이터의 분리를 카프카에서 컨슈머를 늘려 기능을 분리하여 카프카내에서 처리할 수 있다.
* 장애 버그로 인해 브로커가 죽은적이 있음. 랙이 아예 파워가 죽어서 장애 발생
* 서버 장애 동기화 관련
* jmx 권장 값이 5~6기가 이다보니 해당 권장 메모리로 설정을 함
* 

* 우버, 링크드인 등의 기술블로그에 많은 자료를 공유하고 있음.
* 페이스북 그룹도 있음.